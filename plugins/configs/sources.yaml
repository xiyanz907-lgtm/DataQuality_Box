# sources.yaml
# 数据源配置文件
#
# 功能：定义数据提取规则
# 使用者：UniversalLoaderOperator

sources:
  # 数据源 1：MySQL - 作业汇总表
  - id: mysql_summary
    type: mysql
    conn_id: mysql_default  # Airflow Connection ID
    query: |
      SELECT
        cycle_id,
        vehicle_id,
        start_time,
        end_time,
        TIMESTAMPDIFF(SECOND, start_time, end_time) AS duration,
        is_twin_lift,
        box_count,
        task_type
      FROM operation_summary
      WHERE DATE(start_time) = '{{ ds }}'  # Jinja2 模板支持
    
    # 输出配置
    output:
      key: raw_mysql_summary  # 写入 Context 的 key
      stage: RAW              # 数据阶段（RAW / ENTITY / RESULT）
  
  # 数据源 2：InfluxDB - 时序数据（示例，曳光弹场景暂不使用）
  # - id: influx_vehicle_state
  #   type: influxdb
  #   conn_id: influxdb_default
  #   query: |
  #     SELECT
  #       vehicle_id,
  #       time,
  #       position_x,
  #       position_y,
  #       speed
  #     FROM vehicle_state
  #     WHERE time >= '{{ data_interval_start }}' AND time < '{{ data_interval_end }}'
  #   
  #   output:
  #     key: raw_influx_vehicle
  #     stage: RAW

  # 数据源 3：S3 - 外部数据文件（示例）
  # - id: s3_external_data
  #   type: s3
  #   bucket: governance-data
  #   prefix: external/{{ ds }}/
  #   file_pattern: "*.parquet"
  #   
  #   output:
  #     key: raw_s3_external
  #     stage: RAW
