source_meta:
  id: "mysql_datalog_raw"
  type: "mysql"
  connection_id: "datalog_mysql_conn"

# Task 1: 依赖检查
dependency:
  enabled: true
  mode: "sql_check"
  # 只要主表有当班数据，即视为 Ready
  logic: "SELECT 1 FROM cycle_section_summary WHERE shift_date = '{{ ds }}' LIMIT 1"
  timeout: 3600

# Task 2: 数据抽取 (定义两张表的抽取逻辑)
extraction:
  # 表 A: Summary
  - table_key: "summary"
    sql: "SELECT * FROM cycle_section_summary WHERE shift_date = '{{ ds }}'"
    output_path: "raw/summary_{{ ts_nodash }}.parquet"

  # 表 B: Subtarget (附表)
  - table_key: "subtarget"
    sql: "SELECT * FROM subtarget_vehicle_cycle WHERE SHIFT_DATE = '{{ ds }}'"
    output_path: "raw/subtarget_{{ ts_nodash }}.parquet"